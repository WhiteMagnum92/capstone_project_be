package com.capstone_be.controllers;

import java.util.List;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.capstone_be.entities.Personaggio;
import com.capstone_be.services.PersonaggioService;
import com.capstone_be.utilities.Domanda;
import com.capstone_be.utilities.Elfo;
import com.capstone_be.utilities.Gnomo;
import com.capstone_be.utilities.Halfling;
import com.capstone_be.utilities.Mezzelfo;
import com.capstone_be.utilities.Razza;

@RestController
@RequestMapping("/api/pg")
public class CapstoneController {
	
	private PersonaggioService personaggioService;
	public CapstoneController(PersonaggioService personaggioService) {
        this.personaggioService = personaggioService;
    }
	
	
	@GetMapping(value = {"/personaggi"})
    public ResponseEntity<List<Personaggio>> getPersonaggi(){
		return ResponseEntity.ok(personaggioService.getAll());
    }
	
	@GetMapping(value = {"/personaggi/{id}"})
    public ResponseEntity<Personaggio> getPersonaggio(@PathVariable Integer id){
		return ResponseEntity.ok(personaggioService.getById(id));
    }
	
	@GetMapping(value = {"/personaggi"})
    public ResponseEntity<String> creaPersonaggio(@RequestParam String nome){
		Personaggio oldP=personaggioService.findByName(nome);
		if(oldP!=null)
			return ResponseEntity.ok("Personaggio con stesso nome gia presente");
		Personaggio p=new Personaggio();
		p.setName(nome);
		
		personaggioService.save(p);
		
		return ResponseEntity.ok(""+p.getId());
    }
	@GetMapping(value= {"/personaggi/{id}/setrazza"})
	public ResponseEntity<List<Domanda>> setRazza(@PathVariable Integer id, @RequestParam String razza)
	{
		Personaggio p=personaggioService.getById(id);
		p.setRazza(razza);
		Razza r=null;
		switch(razza){
			case "Elfo":
				r= new Elfo();
				break;
			case "Mezzelfo":
				r=new Mezzelfo();
				break;
			case "Gnomo":
				r=new Gnomo();
				break;
			case "Halfling":
				r=new Halfling();
				break;
		}
		r.applicaCambiamenti(p);
		personaggioService.save(p);
		List<Domanda> domande=r.modificheNecessarie();
		
		return ResponseEntity.ok(domande);		
	}
	
	@PostMapping(value= {"/personaggi/{id}/setrazza"})
	public ResponseEntity<Boolean> setRisposteRazza(@RequestBody List<List<String>> risposte, @PathVariable Integer id)
	{
		Personaggio p=personaggioService.getById(id);
		String razza=p.getRazza();
		Razza r=null;
		switch(razza){
			case "Elfo":
				r= new Elfo();
				break;
			case "Mezzelfo":
				r=new Mezzelfo();
				break;
		}
		Boolean res=r.setModifiche(risposte, p);
		if(res)
			personaggioService.save(p);
		
		return ResponseEntity.ok(res);		
	}
	
	
	
	
	
}
